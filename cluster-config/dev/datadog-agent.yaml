---
---
# Source: datadog/templates/agent-clusterchecks-rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
    app: "datadog-agent"
    chart: "datadog-3.6.7"
    heritage: "Helm"
    release: "datadog-agent"
  name: datadog-agent-cluster-checks
  namespace: default
---

# Source: datadog/templates/cluster-agent-rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: "datadog-agent"
    chart: "datadog-3.6.7"
    heritage: "Helm"
    release: "datadog-agent"
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-agent
  namespace: default
---

# Source: datadog/templates/rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: datadog-agent
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7" # end range $role := .Values.datadog.secretBackend.roles
---

# Source: datadog/templates/secret-cluster-agent-token.yaml
apiVersion: v1
kind: Secret
metadata:
  name: datadog-agent-cluster-agent
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
type: Opaque
data:
  token: "V3pNU1NSaGVPUWdUbDBlZllyMUxGSVJCRnkxVkdGTks="
---

# Source: datadog/templates/cluster-agent-confd-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: datadog-agent-cluster-agent-confd
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  annotations:
    checksum/confd-config: 44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a
data:
  kubernetes_state_core.yaml.default: |-
    init_config:
    instances:
      - collectors:
        - secrets
        - nodes
        - pods
        - services
        - resourcequotas
        - replicationcontrollers
        - limitranges
        - persistentvolumeclaims
        - persistentvolumes
        - namespaces
        - endpoints
        - daemonsets
        - deployments
        - replicasets
        - statefulsets
        - cronjobs
        - jobs
        - horizontalpodautoscalers
        - poddisruptionbudgets
        - storageclasses
        - volumeattachments
        - ingresses
        labels_as_tags:
          {}
        annotations_as_tags:
          {}
---

# Source: datadog/templates/confd-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: datadog-agent-confd
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  annotations:
    checksum/confd-config: c4fd22090d9f31f8df2251ffbb2171fc29992e615a4dc0b4b6d33f1b30410afd
    checksum/autoconf-config: 74234e98afe7498fb5daf1f36ac2d78acc339464f950703b8c019892f982b90b
data:

  elastic.yaml: |-
    init_config:
      service: optiq
    instances:
      - url: http://traefik-ingress-service-internal-elasticsearch
        username: elastic
        password: 123456789
        auth_type: basic
        cluster_stats: true
        pshard_stats: true
        index_stats: true
        logs_enabled: true
  optiqlogs.yaml: |-
    init_config:
      service: optiq
    logs:
      - type: file
        path: "/mnt/azure/*-optiq-doc*.log"
        source: "optiq-doc"
      - type: file
        path: "/mnt/azure/*-optiq-extract*.log"
        source: "optiq-extract"
      - type: file
        path: "/mnt/azure/*-optiq-ingest*.log"
        source: "optiq-ingest"
      - type: file
        path: "/mnt/azure/*-optiq-journal*.log"
        source: "optiq-journal"
      - type: file
        path: "/mnt/azure/*-optiq-provisioning*.log"
        source: "optiq-provisioning"
      - type: file
        path: "/mnt/azure/*-optiq-search*.log"
        source: "optiq-search"
      - type: file
        path: "/mnt/azure/*es-operator*.log"
        source: "es-operator"
      - type: file
        path: "/mnt/azure/*opensearch*.log"
        source: "optiq-opensearch"
---

# Source: datadog/templates/install_info-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: datadog-agent-installinfo
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  annotations:
    checksum/install_info: 38d9679f595611e5080f5d6eb1937ad487e93f12aec25c949d63e991d46ca92b
data:
  install_info: |
    ---
    install_method:
      tool: helm
      tool_version: Helm
      installer_version: datadog-3.6.7
---

# Source: datadog/templates/system-probe-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: datadog-agent-system-probe-config
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
data:
  system-probe.yaml: |
    system_probe_config:
      enabled: true
      debug_port:  0
      sysprobe_socket: /var/run/sysprobe/sysprobe.sock
      enable_conntrack: true
      bpf_debug: false
      enable_tcp_queue_length: true
      enable_oom_kill: true
      collect_dns_stats: true
      max_tracked_connections: 131072
      conntrack_max_state_size: 131072
      runtime_compiler_output_dir: /var/tmp/datadog-agent/system-probe/build
      kernel_header_download_dir: /var/tmp/datadog-agent/system-probe/kernel-headers
      apt_config_dir: /host/etc/apt
      yum_repos_dir: /host/etc/yum.repos.d
      zypper_repos_dir: /host/etc/zypp/repos.d
      btf_path: 
    network_config:
      enabled: true
      conntrack_init_timeout: 10s
    service_monitoring_config:
      enabled: false
    runtime_security_config:
      enabled: true
      fim_enabled: false
      socket: /var/run/sysprobe/runtime-security.sock
      policies:
        dir: /etc/datadog-agent/runtime-security.d
      syscall_monitor:
        enabled: false
      network:
        enabled: false
      activity_dump:
        enabled: false
        traced_cgroups_count: 0
---

# Source: datadog/templates/system-probe-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: datadog-agent-security
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
data:
  system-probe-seccomp.json: |
    {
      "defaultAction": "SCMP_ACT_ERRNO",
      "syscalls": [
        {
          "names": [
            "accept4",
            "access",
            "arch_prctl",
            "bind",
            "bpf",
            "brk",
            "capget",
            "capset",
            "chdir",
            "chmod",
            "clock_gettime",
            "clone",
            "clone3",
            "close",
            "connect",
            "copy_file_range",
            "creat",
            "dup",
            "dup2",
            "dup3",
            "epoll_create",
            "epoll_create1",
            "epoll_ctl",
            "epoll_ctl_old",
            "epoll_pwait",
            "epoll_wait",
            "epoll_wait_old",
            "eventfd",
            "eventfd2",
            "execve",
            "execveat",
            "exit",
            "exit_group",
            "faccessat",
            "faccessat2",
            "fchmod",
            "fchmodat",
            "fchown",
            "fchown32",
            "fchownat",
            "fcntl",
            "fcntl64",
            "flock",
            "fstat",
            "fstat64",
            "fstatfs",
            "fsync",
            "futex",
            "getcwd",
            "getdents",
            "getdents64",
            "getegid",
            "geteuid",
            "getgid",
            "getgroups",
            "getpeername",
            "getpgrp",
            "getpid",
            "getppid",
            "getpriority",
            "getrandom",
            "getresgid",
            "getresgid32",
            "getresuid",
            "getresuid32",
            "getrlimit",
            "getrusage",
            "getsid",
            "getsockname",
            "getsockopt",
            "gettid",
            "gettimeofday",
            "getuid",
            "getxattr",
            "ioctl",
            "ipc",
            "listen",
            "lseek",
            "lstat",
            "lstat64",
            "madvise",
            "mkdir",
            "mkdirat",
            "mmap",
            "mmap2",
            "mprotect",
            "mremap",
            "munmap",
            "nanosleep",
            "newfstatat",
            "open",
            "openat",
            "openat2",
            "pause",
            "perf_event_open",
            "pipe",
            "pipe2",
            "poll",
            "ppoll",
            "prctl",
            "pread64",
            "prlimit64",
            "pselect6",
            "read",
            "readlink",
            "readlinkat",
            "recvfrom",
            "recvmmsg",
            "recvmsg",
            "rename",
            "renameat",
            "renameat2",
            "restart_syscall",
            "rmdir",
            "rseq",
            "rt_sigaction",
            "rt_sigpending",
            "rt_sigprocmask",
            "rt_sigqueueinfo",
            "rt_sigreturn",
            "rt_sigsuspend",
            "rt_sigtimedwait",
            "rt_tgsigqueueinfo",
            "sched_getaffinity",
            "sched_yield",
            "seccomp",
            "select",
            "semtimedop",
            "send",
            "sendmmsg",
            "sendmsg",
            "sendto",
            "set_robust_list",
            "set_tid_address",
            "setgid",
            "setgid32",
            "setgroups",
            "setgroups32",
            "setitimer",
            "setns",
            "setpgid",
            "setrlimit",
            "setsid",
            "setsidaccept4",
            "setsockopt",
            "setuid",
            "setuid32",
            "sigaltstack",
            "socket",
            "socketcall",
            "socketpair",
            "stat",
            "stat64",
            "statfs",
            "symlinkat",
            "sysinfo",
            "tgkill",
            "umask",
            "uname",
            "unlink",
            "unlinkat",
            "wait4",
            "waitid",
            "waitpid",
            "write"
          ],
          "action": "SCMP_ACT_ALLOW",
          "args": null
        },
        {
          "names": [
            "setns"
          ],
          "action": "SCMP_ACT_ALLOW",
          "args": [
            {
              "index": 1,
              "value": 1073741824,
              "valueTwo": 0,
              "op": "SCMP_CMP_EQ"
            }
          ],
          "comment": "",
          "includes": {},
          "excludes": {}
        },
        {
          "names": [
            "kill"
          ],
          "action": "SCMP_ACT_ALLOW",
          "args": [
            {
              "index": 1,
              "value": 0,
              "op": "SCMP_CMP_EQ"
            }
          ],
          "comment": "allow process detection via kill",
          "includes": {},
          "excludes": {}
        }
      ]
    }
---

# Source: datadog/charts/datadog-crds/templates/datadoghq.com_datadogmetrics_v1.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.4.1
  creationTimestamp: null
  name: datadogmetrics.datadoghq.com
  labels:
    helm.sh/chart: 'datadog-crds-0.4.7'
    app.kubernetes.io/managed-by: 'Helm'
    app.kubernetes.io/name: 'datadog-crds'
    app.kubernetes.io/instance: 'datadog-agent'
spec:
  group: datadoghq.com
  names:
    kind: DatadogMetric
    listKind: DatadogMetricList
    plural: datadogmetrics
    singular: datadogmetric
  scope: Namespaced
  versions:
    - additionalPrinterColumns:
        - jsonPath: .status.conditions[?(@.type=='Active')].status
          name: active
          type: string
        - jsonPath: .status.conditions[?(@.type=='Valid')].status
          name: valid
          type: string
        - jsonPath: .status.currentValue
          name: value
          type: string
        - jsonPath: .status.autoscalerReferences
          name: references
          type: string
        - jsonPath: .status.conditions[?(@.type=='Updated')].lastUpdateTime
          name: update time
          type: date
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: DatadogMetric allows autoscaling on arbitrary Datadog query
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: DatadogMetricSpec defines the desired state of DatadogMetric
              properties:
                externalMetricName:
                  description: ExternalMetricName is reserved for internal use
                  type: string
                maxAge:
                  description: MaxAge provides the max age for the metric query (overrides the default setting `external_metrics_provider.max_age`)
                  type: string
                query:
                  description: Query is the raw datadog query
                  type: string
              type: object
            status:
              description: DatadogMetricStatus defines the observed state of DatadogMetric
              properties:
                autoscalerReferences:
                  description: List of autoscalers currently using this DatadogMetric
                  type: string
                conditions:
                  description: Conditions Represents the latest available observations of a DatadogMetric's current state.
                  items:
                    description: DatadogMetricCondition describes the state of a DatadogMetric at a certain point.
                    properties:
                      lastTransitionTime:
                        description: Last time the condition transitioned from one status to another.
                        format: date-time
                        type: string
                      lastUpdateTime:
                        description: Last time the condition was updated.
                        format: date-time
                        type: string
                      message:
                        description: A human readable message indicating details about the transition.
                        type: string
                      reason:
                        description: The reason for the condition's last transition.
                        type: string
                      status:
                        description: Status of the condition, one of True, False, Unknown.
                        type: string
                      type:
                        description: Type of DatadogMetric condition.
                        type: string
                    required:
                      - status
                      - type
                    type: object
                  type: array
                  x-kubernetes-list-map-keys:
                    - type
                  x-kubernetes-list-type: map
                currentValue:
                  description: Value is the latest value of the metric
                  type: string
              required:
                - currentValue
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---

# Source: datadog/templates/cluster-agent-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRole
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-agent
rules:
- apiGroups:
  - ""
  resources:
  - services
  - endpoints
  - pods
  - nodes
  - namespaces
  - componentstatuses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - get
  - list
  - watch
  - create
- apiGroups: ["quota.openshift.io"]
  resources:
  - clusterresourcequotas
  verbs:
  - get
  - list
- apiGroups:
  - "autoscaling"
  resources:
  - horizontalpodautoscalers
  verbs:
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - configmaps
  resourceNames:
  - datadog-agenttoken  # Kubernetes event collection state
  - datadogtoken  # Kept for backward compatibility with agent <7.37.0
  verbs:
  - get
  - update
- apiGroups:
  - ""
  resources:
  - configmaps
  resourceNames:
  - datadog-agent-leader-election  # Leader election token
  - datadog-leader-election  # Kept for backward compatibility with agent <7.37.0
  - datadog-custom-metrics
  verbs:
  - get
  - update
- apiGroups:
  - ""
  resources:
  - configmaps
  resourceNames:
  - extension-apiserver-authentication
  verbs:
  - get
  - list
  - watch
- apiGroups:  # To create the leader election token and hpa events
  - ""
  resources:
  - configmaps
  - events
  verbs:
  - create
- nonResourceURLs:
  - "/version"
  - "/healthz"
  verbs:
  - get
- apiGroups:  # to get the kube-system namespace UID and generate a cluster ID
  - ""
  resources:
  - namespaces
  resourceNames:
  - "kube-system"
  verbs:
  - get
- apiGroups:  # To create the cluster-id configmap
  - ""
  resources:
  - configmaps
  resourceNames:
  - "datadog-cluster-id"
  verbs:
  - create
  - get
  - update
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  - persistentvolumeclaims
  - serviceaccounts
  verbs:
  - list
  - get
  - watch
- apiGroups:
  - "apps"
  resources:
  - deployments
  - replicasets
  - daemonsets
  - statefulsets
  verbs:
  - list
  - get
  - watch
- apiGroups:
  - "batch"
  resources:
  - cronjobs
  - jobs
  verbs:
  - list
  - get
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs:
  - list
  - get
  - watch
- apiGroups:
  - "rbac.authorization.k8s.io"
  resources:
  - roles
  - rolebindings
  - clusterroles
  - clusterrolebindings
  verbs:
  - list
  - get
  - watch
- apiGroups:
    - "apiextensions.k8s.io"
  resources:
    - customresourcedefinitions
  verbs:
    - list
    - get
    - watch
- apiGroups:
  - "datadoghq.com"
  resources:
  - "datadogmetrics"
  verbs:
  - "list"
  - "create"
  - "delete"
  - "watch"
- apiGroups:
  - "datadoghq.com"
  resources:
  - "datadogmetrics/status"
  verbs:
  - "update"
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  verbs: ["get", "list", "watch", "update", "create"]
- apiGroups: ["batch"]
  resources: ["jobs", "cronjobs"]
  verbs: ["get"]
- apiGroups: ["apps"]
  resources: ["statefulsets", "replicasets", "deployments", "daemonsets"]
  verbs: ["get"]
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  - namespaces
  verbs:
  - list
- apiGroups:
  - "policy"
  resources:
  - podsecuritypolicies
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterrolebindings
  - rolebindings
  verbs:
  - list
- apiGroups:
  - networking.k8s.io
  resources:
  - networkpolicies
  verbs:
  - list
- apiGroups:
  - policy
  resources:
  - podsecuritypolicies
  verbs:
  - use
  resourceNames:
  - datadog-agent-cluster-agent
- apiGroups:
  - "security.openshift.io"
  resources:
  - securitycontextconstraints
  verbs:
  - use
  resourceNames:
  - datadog-agent-cluster-agent
  - hostnetwork
---

# Source: datadog/templates/hpa-external-metrics-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRole
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-agent-external-metrics-reader
rules:
- apiGroups:
  - "external.metrics.k8s.io"
  resources:
  - "*"
  verbs:
  - list
  - get
  - watch
---

# Source: datadog/templates/kube-state-metrics-core-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRole
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-ksm-core
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  - nodes
  - pods
  - services
  - resourcequotas
  - replicationcontrollers
  - limitranges
  - persistentvolumeclaims
  - persistentvolumes
  - namespaces
  - endpoints
  - events
  verbs:
  - list
  - watch
- apiGroups:
  - extensions
  resources:
  - daemonsets
  - deployments
  - replicasets
  verbs:
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  - daemonsets
  - deployments
  - replicasets
  verbs:
  - list
  - watch
- apiGroups:
  - batch
  resources:
  - cronjobs
  - jobs
  verbs:
  - list
  - watch
- apiGroups:
  - autoscaling
  resources:
  - horizontalpodautoscalers
  verbs:
  - list
  - watch
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - list
  - watch
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  - volumeattachments
  verbs:
  - list
  - watch    
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs:
  - list
  - watch
---

# Source: datadog/templates/rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRole
metadata:
  name: datadog-agent
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
rules:
- nonResourceURLs:
  - "/metrics"
  verbs:
  - get
- apiGroups:  # Kubelet connectivity
  - ""
  resources:
  - nodes/metrics
  - nodes/spec
  - nodes/proxy
  - nodes/stats
  verbs:
  - get
- apiGroups:  # leader election check
  - ""
  resources:
  - endpoints
  verbs:
  - get
- apiGroups:
  - policy
  resources:
  - podsecuritypolicies
  verbs:
  - use
  resourceNames:
  - datadog-agent
- apiGroups:
  - "security.openshift.io"
  resources:
  - securitycontextconstraints
  verbs:
  - use
  resourceNames:
  - datadog-agent
  - hostaccess
  - privileged
- apiGroups:  # leader election check
  - "coordination.k8s.io"
  resources:
  - leases
  verbs:
  - get
---

# Source: datadog/templates/agent-clusterchecks-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRoleBinding
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-checks
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: datadog-agent
subjects:
  - kind: ServiceAccount
    name: datadog-agent-cluster-checks
    namespace: default
---

# Source: datadog/templates/cluster-agent-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRoleBinding
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-agent
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: datadog-agent-cluster-agent
subjects:
  - kind: ServiceAccount
    name: datadog-agent-cluster-agent
    namespace: default
---

# Source: datadog/templates/cluster-agent-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRoleBinding
metadata:
  labels:
    app: "datadog-agent"
    chart: "datadog-3.6.7"
    release: "datadog-agent"
    heritage: "Helm"
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-agent-system-auth-delegator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:auth-delegator
subjects:
  - kind: ServiceAccount
    name: datadog-agent-cluster-agent
    namespace: default
---

# Source: datadog/templates/hpa-external-metrics-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRoleBinding
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-agent-external-metrics-reader
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: datadog-agent-cluster-agent-external-metrics-reader
subjects:
- kind: ServiceAccount
  name: horizontal-pod-autoscaler
  namespace: kube-system
---

# Source: datadog/templates/kube-state-metrics-core-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRoleBinding
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-ksm-core
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: datadog-agent-ksm-core
subjects:
  - kind: ServiceAccount
    name: datadog-agent-cluster-agent
    namespace: default
---

# Source: datadog/templates/rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: ClusterRoleBinding
metadata:
  name: datadog-agent
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: datadog-agent
subjects:
  - kind: ServiceAccount
    name: datadog-agent
    namespace: default
---

# Source: datadog/templates/cluster-agent-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: Role
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: datadog-agent-cluster-agent-main
  namespace: default
rules:
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get", "list", "watch", "update", "create"]
---

# Source: datadog/templates/cluster-agent-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: RoleBinding
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: "datadog-agent-cluster-agent-main"
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: datadog-agent-cluster-agent-main
subjects:
  - kind: ServiceAccount
    name: datadog-agent-cluster-agent
    namespace: default
---

# Source: datadog/templates/cluster-agent-rbac.yaml
apiVersion: "rbac.authorization.k8s.io/v1"
kind: RoleBinding
metadata:
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
  name: "datadog-agent-cluster-agent-apiserver"
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: extension-apiserver-authentication-reader
subjects:
  - kind: ServiceAccount
    name: datadog-agent-cluster-agent
    namespace: default
---

# Source: datadog/templates/agent-services.yaml
apiVersion: v1
kind: Service
metadata:
  name: datadog-agent-cluster-agent
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
spec:
  type: ClusterIP
  selector:
    app: datadog-agent-cluster-agent
  ports:
  - port: 5005
    name: agentport
    protocol: TCP
---

# Source: datadog/templates/agent-services.yaml
apiVersion: v1
kind: Service
metadata:
  name: datadog-agent-cluster-agent-metrics-api
  namespace: default
  labels:
    app: "datadog-agent"
    chart: "datadog-3.6.7"
    release: "datadog-agent"
    heritage: "Helm"
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
spec:
  type: ClusterIP
  selector:
    app: datadog-agent-cluster-agent
  ports:
  - port: 8443
    name: metricsapi
    protocol: TCP
---

# Source: datadog/templates/agent-services.yaml
apiVersion: v1
kind: Service
metadata:
  name: datadog-agent-cluster-agent-admission-controller
  namespace: default
  labels:
    app: "datadog-agent"
    chart: "datadog-3.6.7"
    release: "datadog-agent"
    heritage: "Helm"
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
spec:
  selector:
    app: datadog-agent-cluster-agent
  ports:
  - port: 443
    targetPort: 8000
---

# Source: datadog/templates/agent-services.yaml
apiVersion: v1
kind: Service

metadata:
  name: datadog-agent
  namespace: default
  labels:
    app: "datadog-agent"
    chart: "datadog-3.6.7"
    release: "datadog-agent"
    heritage: "Helm"
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
spec:
  selector:
    app: datadog-agent
  ports:
    - protocol: UDP
      port: 8125
      targetPort: 8125
      name: dogstatsd
    - protocol: TCP
      port: 8126
      targetPort: 8126
      name: traceport
  internalTrafficPolicy: Local
---

# Source: datadog/templates/daemonset.yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: datadog-agent
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
    app.kubernetes.io/component: agent
    
spec:
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: datadog-agent
  template:
    metadata:
      labels:
        app.kubernetes.io/name: "datadog-agent"
        app.kubernetes.io/instance: "datadog-agent"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: agent
        app: datadog-agent
        
      name: datadog-agent
      annotations:
        checksum/clusteragent_token: 611b5e88aa6361f1da8e4b0d20ae9747ea86acb7d7f2554dfc1b669c61745393
        checksum/install_info: 38d9679f595611e5080f5d6eb1937ad487e93f12aec25c949d63e991d46ca92b
        checksum/autoconf-config: 74234e98afe7498fb5daf1f36ac2d78acc339464f950703b8c019892f982b90b
        checksum/confd-config: c4fd22090d9f31f8df2251ffbb2171fc29992e615a4dc0b4b6d33f1b30410afd
        checksum/checksd-config: 44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a
        container.apparmor.security.beta.kubernetes.io/system-probe: unconfined
    spec:
      
      securityContext:
        runAsUser: 0
      hostPID: true
      containers:
      - name: agent
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        command: ["agent", "run"]
        
        resources:
          {}
        ports:
        - containerPort: 8125
          hostPort: 8125
          name: dogstatsdport
          protocol: UDP
        envFrom:
          - secretRef:
              name: cluster-secrets
        env:
          # Needs to be removed when Agent N-2 is built with Golang 1.17
          - name: GODEBUG
            value: x509ignoreCN=0
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
          - name: DD_KUBERNETES_KUBELET_HOST
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: DD_KUBELET_TLS_VERIFY
            value: "false"
          - name: DD_TAGS
            value: "service:optiq"
          - name: KUBERNETES
            value: "yes"
          - name: DD_ENV
            value: "dev"
          - name: DD_CLUSTER_NAME
            value: "$(CLUSTER_NAME)"
          - name: DD_APM_IGNORE_RESOURCES
            value: "GET /health, GET /api/health, POST rt.services.visualstudio.com/QuickPulseService.svc/ping, POST dc.services.visualstudio.com/v2/track"
          - name: DD_LOGS_CONFIG_PROCESSING_RULES
            value: "[{\"type\": \"exclude_at_match\", \"name\": \"exclude_health_check_logs\", \"pattern\" : \"\\/health\"}]"
          - name: DD_CONTAINER_INCLUDE_LOGS
            value: "image:episerver.azurecr.io/optiq-traefik-turnstile  image:docker.io/fluxcd/flux"
          - name: DD_CONTAINER_EXCLUDE_LOGS
            value: "image:.*"
          
          - name: DD_LOG_LEVEL
            value: "INFO"
          - name: DD_DOGSTATSD_PORT
            value: "8125"
          - name: DD_DOGSTATSD_NON_LOCAL_TRAFFIC
            value: "true"
          - name: DD_CLUSTER_AGENT_ENABLED
            value: "true"
          - name: DD_CLUSTER_AGENT_KUBERNETES_SERVICE_NAME
            value: datadog-agent-cluster-agent
          - name: DD_CLUSTER_AGENT_AUTH_TOKEN
            valueFrom:
              secretKeyRef:
                  name: datadog-agent-cluster-agent
                  key: token
          
          - name: DD_APM_ENABLED
            value: "false"
          - name: DD_LOGS_ENABLED
            value: "true"
          - name: DD_LOGS_CONFIG_CONTAINER_COLLECT_ALL
            value: "true"
          - name: DD_LOGS_CONFIG_K8S_CONTAINER_USE_FILE
            value: "true"
          - name: DD_LOGS_CONFIG_AUTO_MULTI_LINE_DETECTION
            value: "false"
          - name: DD_HEALTH_PORT
            value: "5555"
          - name: DD_DOGSTATSD_SOCKET
            value: "/var/run/datadog/dsd.socket"
          - name: DD_EXTRA_CONFIG_PROVIDERS
            value: "endpointschecks"
          
          - name: DD_IGNORE_AUTOCONF
            value: "kubernetes_state"
          - name: DD_EXPVAR_PORT
            value: "6000"    
        volumeMounts:
          - name: installinfo
            subPath: install_info
            mountPath: /etc/datadog-agent/install_info
            readOnly: true
          - name: logdatadog
            mountPath: /var/log/datadog
          - name: tmpdir
            mountPath: /tmp
            readOnly: false
          
          - name: os-release-file
            mountPath: /host/etc/os-release
            mountPropagation: None
            readOnly: true
          - name: config
            mountPath: /etc/datadog-agent
          
          - name: runtimesocketdir
            mountPath: /host/var/run
            mountPropagation: None
            readOnly: true
          
          - name: dsdsocket
            mountPath: /var/run/datadog
          - name: sysprobe-socket-dir
            mountPath: /var/run/sysprobe
            readOnly: true
          - name: sysprobe-config
            mountPath: /etc/datadog-agent/system-probe.yaml
            subPath: system-probe.yaml
          - name: procdir
            mountPath: /host/proc
            mountPropagation: None
            readOnly: true
          - name: cgroups
            mountPath: /host/sys/fs/cgroup
            mountPropagation: None
            readOnly: true
          - name: pointerdir
            mountPath: /opt/datadog-agent/run
            mountPropagation: None
          - name: logpodpath
            mountPath: /var/log/pods
            mountPropagation: None
            readOnly: true
          - name: logscontainerspath
            mountPath: /var/log/containers
            mountPropagation: None
            readOnly: true
          - name: logdockercontainerpath
            mountPath: /var/lib/docker/containers
            mountPropagation: None
            readOnly: true
          - mountPath: /mnt/azure
            name: azure
        livenessProbe:
          failureThreshold: 6
          httpGet:
            path: /live
            port: 5555
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        readinessProbe:
          failureThreshold: 6
          httpGet:
            path: /ready
            port: 5555
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
      - name: trace-agent
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        command: ["trace-agent", "-config=/etc/datadog-agent/datadog.yaml"]  
        resources:
          {}
        ports:
        - containerPort: 8126
          hostPort: 8126
          name: traceport
          protocol: TCP
        envFrom:
          - secretRef:
              name: cluster-secrets
        env:
          # Needs to be removed when Agent N-2 is built with Golang 1.17
          - name: GODEBUG
            value: x509ignoreCN=0
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
          - name: DD_KUBERNETES_KUBELET_HOST
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: DD_KUBELET_TLS_VERIFY
            value: "false"
          - name: DD_TAGS
            value: "service:optiq"
          - name: KUBERNETES
            value: "yes"
          - name: DD_ENV
            value: "dev"
          - name: DD_CLUSTER_NAME
            value: "$(CLUSTER_NAME)"
          - name: DD_APM_IGNORE_RESOURCES
            value: "GET /health, GET /api/health, POST rt.services.visualstudio.com/QuickPulseService.svc/ping, POST dc.services.visualstudio.com/v2/track"
          - name: DD_LOGS_CONFIG_PROCESSING_RULES
            value: "[{\"type\": \"exclude_at_match\", \"name\": \"exclude_health_check_logs\", \"pattern\" : \"\\/health\"}]"
          - name: DD_CONTAINER_INCLUDE_LOGS
            value: "image:episerver.azurecr.io/optiq-traefik-turnstile  image:docker.io/fluxcd/flux"
          - name: DD_CONTAINER_EXCLUDE_LOGS
            value: "image:.*"
          
          - name: DD_CLUSTER_AGENT_ENABLED
            value: "true"
          - name: DD_CLUSTER_AGENT_KUBERNETES_SERVICE_NAME
            value: datadog-agent-cluster-agent
          - name: DD_CLUSTER_AGENT_AUTH_TOKEN
            valueFrom:
              secretKeyRef:
                  name: datadog-agent-cluster-agent
                  key: token
          
          - name: DD_LOG_LEVEL
            value: "INFO"
          - name: DD_APM_ENABLED
            value: "true"
          - name: DD_APM_NON_LOCAL_TRAFFIC
            value: "true"
          - name: DD_APM_RECEIVER_PORT
            value: "8126"
          - name: DD_APM_RECEIVER_SOCKET
            value: "/var/run/datadog/apm.socket"
          - name: DD_DOGSTATSD_SOCKET
            value: "/var/run/datadog/dsd.socket"    
        volumeMounts:
          - name: config
            mountPath: /etc/datadog-agent
          - name: procdir
            mountPath: /host/proc
            mountPropagation: None
            readOnly: true
          - name: cgroups
            mountPath: /host/sys/fs/cgroup
            mountPropagation: None
            readOnly: true
          - name: logdatadog
            mountPath: /var/log/datadog
          - name: tmpdir
            mountPath: /tmp
            readOnly: false
          - name: dsdsocket
            mountPath: /var/run/datadog
          
          - name: runtimesocketdir
            mountPath: /host/var/run
            mountPropagation: None
            readOnly: true
          
          - mountPath: /mnt/azure
            name: azure
        livenessProbe:
          initialDelaySeconds: 15
          periodSeconds: 15
          tcpSocket:
            port: 8126
          timeoutSeconds: 5
      - name: process-agent
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        command: ["process-agent", "--cfgpath=/etc/datadog-agent/datadog.yaml"]  
        resources:
          {}
        envFrom:
          - secretRef:
              name: cluster-secrets
        env:
          # Needs to be removed when Agent N-2 is built with Golang 1.17
          - name: GODEBUG
            value: x509ignoreCN=0
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
          - name: DD_KUBERNETES_KUBELET_HOST
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: DD_KUBELET_TLS_VERIFY
            value: "false"
          - name: DD_TAGS
            value: "service:optiq"
          - name: KUBERNETES
            value: "yes"
          - name: DD_ENV
            value: "dev"
          - name: DD_CLUSTER_NAME
            value: "$(CLUSTER_NAME)"
          - name: DD_APM_IGNORE_RESOURCES
            value: "GET /health, GET /api/health, POST rt.services.visualstudio.com/QuickPulseService.svc/ping, POST dc.services.visualstudio.com/v2/track"
          - name: DD_LOGS_CONFIG_PROCESSING_RULES
            value: "[{\"type\": \"exclude_at_match\", \"name\": \"exclude_health_check_logs\", \"pattern\" : \"\\/health\"}]"
          - name: DD_CONTAINER_INCLUDE_LOGS
            value: "image:episerver.azurecr.io/optiq-traefik-turnstile  image:docker.io/fluxcd/flux"
          - name: DD_CONTAINER_EXCLUDE_LOGS
            value: "image:.*"
          
          - name: DD_CLUSTER_AGENT_ENABLED
            value: "true"
          - name: DD_CLUSTER_AGENT_KUBERNETES_SERVICE_NAME
            value: datadog-agent-cluster-agent
          - name: DD_CLUSTER_AGENT_AUTH_TOKEN
            valueFrom:
              secretKeyRef:
                  name: datadog-agent-cluster-agent
                  key: token
          
          - name: DD_PROCESS_AGENT_ENABLED
            value: "true"
          - name: DD_PROCESS_AGENT_DISCOVERY_ENABLED
            value: "false"
          - name: DD_LOG_LEVEL
            value: "INFO"
          - name: DD_SYSTEM_PROBE_ENABLED
            value: "true"
          - name: DD_SYSTEM_PROBE_NETWORK_ENABLED
            value: "true"
          - name: DD_DOGSTATSD_SOCKET
            value: "/var/run/datadog/dsd.socket"
          - name: DD_ORCHESTRATOR_EXPLORER_ENABLED
            value: "true"    
        volumeMounts:
          - name: config
            mountPath: /etc/datadog-agent
          - name: logdatadog
            mountPath: /var/log/datadog
          - name: tmpdir
            mountPath: /tmp
            readOnly: false
          
          - name: os-release-file
            mountPath: /host/etc/os-release
            mountPropagation: None
            readOnly: true
          
          - name: runtimesocketdir
            mountPath: /host/var/run
            mountPropagation: None
            readOnly: true
          
          - name: cgroups
            mountPath: /host/sys/fs/cgroup
            mountPropagation: None
            readOnly: true
          - name: passwd
            mountPath: /etc/passwd
            readOnly: true
          - name: procdir
            mountPath: /host/proc
            mountPropagation: None
            readOnly: true
          - name: dsdsocket
            mountPath: /var/run/datadog
            readOnly: true
          - name: sysprobe-socket-dir
            mountPath: /var/run/sysprobe
            readOnly: true
          - name: sysprobe-config
            mountPath: /etc/datadog-agent/system-probe.yaml
            subPath: system-probe.yaml
          - mountPath: /mnt/azure
            name: azure
      - name: system-probe
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        
        securityContext:
          capabilities:
            add:
            - SYS_ADMIN
            - SYS_RESOURCE
            - SYS_PTRACE
            - NET_ADMIN
            - NET_BROADCAST
            - NET_RAW
            - IPC_LOCK
            - CHOWN
          privileged: false
          seccompProfile:
            type: Localhost
            localhostProfile: system-probe
        command: ["/opt/datadog-agent/embedded/bin/system-probe", "--config=/etc/datadog-agent/system-probe.yaml"]
        envFrom:
          - secretRef:
              name: cluster-secrets
        env:
          # Needs to be removed when Agent N-2 is built with Golang 1.17
          - name: GODEBUG
            value: x509ignoreCN=0
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
          - name: DD_KUBERNETES_KUBELET_HOST
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: DD_KUBELET_TLS_VERIFY
            value: "false"
          - name: DD_TAGS
            value: "service:optiq"
          - name: KUBERNETES
            value: "yes"
          - name: DD_ENV
            value: "dev"
          - name: DD_CLUSTER_NAME
            value: "$(CLUSTER_NAME)"
          - name: DD_APM_IGNORE_RESOURCES
            value: "GET /health, GET /api/health, POST rt.services.visualstudio.com/QuickPulseService.svc/ping, POST dc.services.visualstudio.com/v2/track"
          - name: DD_LOGS_CONFIG_PROCESSING_RULES
            value: "[{\"type\": \"exclude_at_match\", \"name\": \"exclude_health_check_logs\", \"pattern\" : \"\\/health\"}]"
          - name: DD_CONTAINER_INCLUDE_LOGS
            value: "image:episerver.azurecr.io/optiq-traefik-turnstile  image:docker.io/fluxcd/flux"
          - name: DD_CONTAINER_EXCLUDE_LOGS
            value: "image:.*"
          
          - name: DD_LOG_LEVEL
            value: "INFO"    
        resources:
          {}
        volumeMounts:
          - name: logdatadog
            mountPath: /var/log/datadog
          - name: tmpdir
            mountPath: /tmp
            readOnly: false
          - name: debugfs
            mountPath: /sys/kernel/debug
            mountPropagation: None
          - name: config
            mountPath: /etc/datadog-agent
          
          - name: sysprobe-config
            mountPath: /etc/datadog-agent/system-probe.yaml
            subPath: system-probe.yaml
          - name: sysprobe-socket-dir
            mountPath: /var/run/sysprobe
          - name: procdir
            mountPath: /host/proc
            mountPropagation: None
            readOnly: true
          
          - name: os-release-file
            mountPath: /host/etc/os-release
            mountPropagation: None
            readOnly: true
          - name: etc-redhat-release
            mountPath: /host/etc/redhat-release
            readOnly: true
          - name: etc-fedora-release
            mountPath: /host/etc/fedora-release
            readOnly: true
          - name: etc-lsb-release
            mountPath: /host/etc/lsb-release
            readOnly: true
          - name: modules
            mountPath: /lib/modules
            mountPropagation: None
            readOnly: true
          - name: src
            mountPath: /usr/src
            mountPropagation: None
            readOnly: true
          - name: runtime-compiler-output-dir
            mountPath: /var/tmp/datadog-agent/system-probe/build
            mountPropagation: None
          - name: kernel-headers-download-dir
            mountPath: /var/tmp/datadog-agent/system-probe/kernel-headers
            readOnly: false
          - name: apt-config-dir
            mountPath: /host/etc/apt
            readOnly: true
          - name: yum-repos-dir
            mountPath: /host/etc/yum.repos.d
            readOnly: true
          - name: opensuse-repos-dir
            mountPath: /host/etc/zypp
            readOnly: true
          - name: public-key-dir
            mountPath: /host/etc/pki
            readOnly: true
          - name: yum-vars-dir
            mountPath: /host/etc/yum/vars
            readOnly: true
          - name: dnf-vars-dir
            mountPath: /host/etc/dnf/vars
            readOnly: true
          - name: rhel-subscription-dir
            mountPath: /host/etc/rhsm
            readOnly: true
          - mountPath: /mnt/azure
            name: azure
      - name: security-agent
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        securityContext:
          capabilities:
            add: ["AUDIT_CONTROL", "AUDIT_READ"]
        command: ["security-agent", "start", "-c=/etc/datadog-agent/datadog.yaml"]
        resources:
          {}
        envFrom:
          - secretRef:
              name: cluster-secrets
        env:
          # Needs to be removed when Agent N-2 is built with Golang 1.17
          - name: GODEBUG
            value: x509ignoreCN=0
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
          - name: DD_KUBERNETES_KUBELET_HOST
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: DD_KUBELET_TLS_VERIFY
            value: "false"
          - name: DD_TAGS
            value: "service:optiq"
          - name: KUBERNETES
            value: "yes"
          - name: DD_ENV
            value: "dev"
          - name: DD_CLUSTER_NAME
            value: "$(CLUSTER_NAME)"
          - name: DD_APM_IGNORE_RESOURCES
            value: "GET /health, GET /api/health, POST rt.services.visualstudio.com/QuickPulseService.svc/ping, POST dc.services.visualstudio.com/v2/track"
          - name: DD_LOGS_CONFIG_PROCESSING_RULES
            value: "[{\"type\": \"exclude_at_match\", \"name\": \"exclude_health_check_logs\", \"pattern\" : \"\\/health\"}]"
          - name: DD_CONTAINER_INCLUDE_LOGS
            value: "image:episerver.azurecr.io/optiq-traefik-turnstile  image:docker.io/fluxcd/flux"
          - name: DD_CONTAINER_EXCLUDE_LOGS
            value: "image:.*"
          
          - name: DD_CLUSTER_AGENT_ENABLED
            value: "true"
          - name: DD_CLUSTER_AGENT_KUBERNETES_SERVICE_NAME
            value: datadog-agent-cluster-agent
          - name: DD_CLUSTER_AGENT_AUTH_TOKEN
            valueFrom:
              secretKeyRef:
                  name: datadog-agent-cluster-agent
                  key: token
          
          - name: DD_LOG_LEVEL
            value: "INFO"
          - name: DD_COMPLIANCE_CONFIG_ENABLED
            value:  "true"
          - name: DD_COMPLIANCE_CONFIG_CHECK_INTERVAL
            value: "20m"
          - name: HOST_ROOT
            value: /host/root
          - name: DD_RUNTIME_SECURITY_CONFIG_ENABLED
            value:  "true"
          - name: DD_RUNTIME_SECURITY_CONFIG_POLICIES_DIR
            value: "/etc/datadog-agent/runtime-security.d"
          - name: DD_RUNTIME_SECURITY_CONFIG_SOCKET
            value: /var/run/sysprobe/runtime-security.sock
          - name: DD_DOGSTATSD_SOCKET
            value: "/var/run/datadog/dsd.socket"    
        volumeMounts:
          - name: config
            mountPath: /etc/datadog-agent
          - name: logdatadog
            mountPath: /var/log/datadog
          - name: tmpdir
            mountPath: /tmp
            readOnly: false
          - name: dsdsocket
            mountPath: /var/run/datadog
            readOnly: true
          
          - name: os-release-file
            mountPath: /host/etc/os-release
            mountPropagation: None
            readOnly: true
          
          - name: runtimesocketdir
            mountPath: /host/var/run
            mountPropagation: None
            readOnly: true
          
          - name: cgroups
            mountPath: /host/sys/fs/cgroup
            readOnly: true
          - name: passwd
            mountPath: /etc/passwd
            readOnly: true
          - name: group
            mountPath: /etc/group
            readOnly: true
          - name: hostroot
            mountPath: /host/root
            readOnly: true
          - name: procdir
            mountPath: /host/proc
            readOnly: true
          - name: sysprobe-socket-dir
            mountPath: /var/run/sysprobe
            readOnly: true
          - name: sysprobe-config
            mountPath: /etc/datadog-agent/system-probe.yaml
            subPath: system-probe.yaml
          - mountPath: /mnt/azure
            name: azure
      initContainers:
          
      - name: init-volume
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        command: ["bash", "-c"]
        args:
          - cp -r /etc/datadog-agent /opt
        volumeMounts:
          - name: config
            mountPath: /opt/datadog-agent
        resources:
          {}
      - name: init-config
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        command: ["bash", "-c"]
        args:
          - for script in $(find /etc/cont-init.d/ -type f -name '*.sh' | sort) ; do bash $script ; done
        volumeMounts:
          - name: logdatadog
            mountPath: /var/log/datadog
          - name: config
            mountPath: /etc/datadog-agent
          - name: confd
            mountPath: /conf.d
            readOnly: true
          - name: procdir
            mountPath: /host/proc
            mountPropagation: None
            readOnly: true
          
          - name: runtimesocketdir
            mountPath: /host/var/run
            mountPropagation: None
            readOnly: true
          - name: sysprobe-config
            mountPath: /etc/datadog-agent/system-probe.yaml
            subPath: system-probe.yaml
        env:
          # Needs to be removed when Agent N-2 is built with Golang 1.17
          - name: GODEBUG
            value: x509ignoreCN=0
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
          - name: DD_KUBERNETES_KUBELET_HOST
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: DD_KUBELET_TLS_VERIFY
            value: "false"
          - name: DD_TAGS
            value: "service:optiq"
          - name: KUBERNETES
            value: "yes"
          - name: DD_ENV
            value: "dev"
          - name: DD_CLUSTER_NAME
            value: "$(CLUSTER_NAME)"
          - name: DD_APM_IGNORE_RESOURCES
            value: "GET /health, GET /api/health, POST rt.services.visualstudio.com/QuickPulseService.svc/ping, POST dc.services.visualstudio.com/v2/track"
          - name: DD_LOGS_CONFIG_PROCESSING_RULES
            value: "[{\"type\": \"exclude_at_match\", \"name\": \"exclude_health_check_logs\", \"pattern\" : \"\\/health\"}]"
          - name: DD_CONTAINER_INCLUDE_LOGS
            value: "image:episerver.azurecr.io/optiq-traefik-turnstile  image:docker.io/fluxcd/flux"
          - name: DD_CONTAINER_EXCLUDE_LOGS
            value: "image:.*"
          
        resources:
          {}
          
      - name: seccomp-setup
        image: "gcr.io/datadoghq/agent:7.41.1"
        command:
        - cp
        - /etc/config/system-probe-seccomp.json
        - /host/var/lib/kubelet/seccomp/system-probe
        volumeMounts:
        - name: datadog-agent-security
          mountPath: /etc/config
        - name: seccomp-root
          mountPath: /host/var/lib/kubelet/seccomp
          mountPropagation: None
        resources:
          {}
      volumes:
      - name: installinfo
        configMap:
          name: datadog-agent-installinfo
      - name: config
        emptyDir: {}
        
      - name: logdatadog
        emptyDir: {}
      - name: tmpdir
        emptyDir: {}
      - hostPath:
          path: /proc
        name: procdir
      - hostPath:
          path: /sys/fs/cgroup
        name: cgroups
      - hostPath:
          path: /etc/os-release
        name: os-release-file
      - hostPath:
          path: /etc/redhat-release
        name: etc-redhat-release
      - hostPath:
          path: /etc/fedora-release
        name: etc-fedora-release
      - hostPath:
          path: /etc/lsb-release
        name: etc-lsb-release
      - hostPath:
          path: /var/run/datadog/
          type: DirectoryOrCreate
        name: dsdsocket
      - hostPath:
          path: /var/run/datadog/
          type: DirectoryOrCreate
        name: apmsocket
      - name: s6-run
        emptyDir: {}
      - name: confd
        configMap:
          name: datadog-agent-confd
      - name: sysprobe-config
        configMap:
          name: datadog-agent-system-probe-config
      - name: datadog-agent-security
        configMap:
          name: datadog-agent-security
      - hostPath:
          path: /var/lib/kubelet/seccomp
        name: seccomp-root
      - hostPath:
          path: /sys/kernel/debug
        name: debugfs
      - name: sysprobe-socket-dir
        emptyDir: {}
      - hostPath:
          path: /lib/modules
        name: modules
      - hostPath:
          path: /usr/src
        name: src
      - hostPath:
          path: /var/tmp/datadog-agent/system-probe/build
          type: DirectoryOrCreate
        name: runtime-compiler-output-dir
      - hostPath:
          path: /var/tmp/datadog-agent/system-probe/kernel-headers
          type: DirectoryOrCreate
        name: kernel-headers-download-dir
      - hostPath:
          path: /etc/apt
        name: apt-config-dir
      - hostPath:
          path: /etc/yum.repos.d
        name: yum-repos-dir
      - hostPath:
          path: /etc/zypp
        name: opensuse-repos-dir
      - hostPath:
          path: /etc/pki
        name: public-key-dir
      - hostPath:
          path: /etc/yum/vars
        name: yum-vars-dir
      - hostPath:
          path: /etc/dnf/vars
        name: dnf-vars-dir
      - hostPath:
          path: /etc/rhsm
        name: rhel-subscription-dir
      - hostPath:
          path: /etc/passwd
        name: passwd
      - hostPath:
          path: /
        name: hostroot
      - hostPath:
          path: /etc/group
        name: group
      - hostPath:
          path: /var/lib/datadog-agent/logs
        name: pointerdir
      - hostPath:
          path: /var/log/pods
        name: logpodpath
      - hostPath:
          path: /var/log/containers
        name: logscontainerspath
      - hostPath:
          path: /var/lib/docker/containers
        name: logdockercontainerpath
      - hostPath:
          path: /var/run
        name: runtimesocketdir
      - azureFile:
          readOnly: false
          secretName: fileshare-secrets
          shareName: optiq-logs-prod
        name: azure
      tolerations:
      affinity:
        {}
      serviceAccountName: "datadog-agent"
      nodeSelector:
        kubernetes.io/os: linux
  updateStrategy:
    rollingUpdate:
      maxUnavailable: 10%
    type: RollingUpdate
---

# Source: datadog/templates/agent-clusterchecks-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: datadog-agent-clusterchecks
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
    app.kubernetes.io/component: clusterchecks-agent
    
spec:
  replicas: 2
  revisionHistoryLimit: 10
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
    type: RollingUpdate
  selector:
    matchLabels:
      app: datadog-agent-clusterchecks
  template:
    metadata:
      labels:
        app.kubernetes.io/name: "datadog-agent"
        app.kubernetes.io/instance: "datadog-agent"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: clusterchecks-agent
        app: datadog-agent-clusterchecks
        
      name: datadog-agent-clusterchecks
      annotations:
        checksum/clusteragent_token: cc8ce17c7d8ec8efc6cc7b4ecae69153d8fdcaef28fe640c5358d44b50350da5
        checksum/install_info: 38d9679f595611e5080f5d6eb1937ad487e93f12aec25c949d63e991d46ca92b
    spec:
      serviceAccountName: datadog-agent-cluster-checks
      imagePullSecrets:
        []
      initContainers:
      - name: init-volume
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        command: ["bash", "-c"]
        args:
          - cp -r /etc/datadog-agent /opt
        volumeMounts:
          - name: config
            mountPath: /opt/datadog-agent
        resources:
          {}
      - name: init-config
        image: "gcr.io/datadoghq/agent:7.41.1"
        imagePullPolicy: IfNotPresent
        command: ["bash", "-c"]
        args:
          - for script in $(find /etc/cont-init.d/ -type f -name '*.sh' | sort) ; do bash $script ; done
        volumeMounts:
          - name: config
            mountPath: /etc/datadog-agent
        resources:
          {}
      containers:
      - name: agent
        image: "gcr.io/datadoghq/agent:7.41.1"
        command: ["bash", "-c"]
        args:
          - rm -rf /etc/datadog-agent/conf.d && touch /etc/datadog-agent/datadog.yaml && exec agent run
        imagePullPolicy: IfNotPresent
        envFrom:
          - secretRef:
              name: cluster-secrets
        env:
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
          - name: KUBERNETES
            value: "yes"
          - name: DD_LOG_LEVEL
            value: "INFO"
          - name: DD_EXTRA_CONFIG_PROVIDERS
            value: "clusterchecks"
          - name: DD_HEALTH_PORT
            value: "5557"
          # Cluster checks (cluster-agent communication)
          - name: DD_CLUSTER_AGENT_ENABLED
            value: "true"
          - name: DD_CLUSTER_AGENT_KUBERNETES_SERVICE_NAME
            value: datadog-agent-cluster-agent
          - name: DD_CLUSTER_AGENT_AUTH_TOKEN
            valueFrom:
              secretKeyRef:
                  name: datadog-agent-cluster-agent
                  key: token
          
          # Safely run alongside the daemonset
          - name: DD_ENABLE_METADATA_COLLECTION
            value: "false"
          # Expose CLC stats
          - name: DD_CLC_RUNNER_ENABLED
            value: "true"
          - name: DD_CLC_RUNNER_HOST
            valueFrom:
              fieldRef:
                fieldPath: status.podIP
          - name: DD_CLC_RUNNER_ID
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          # Remove unused features
          - name: DD_USE_DOGSTATSD
            value: "false"
          - name: DD_PROCESS_AGENT_ENABLED
            value: "false"
          - name: DD_LOGS_ENABLED
            value: "false"
          - name: DD_APM_ENABLED
            value: "false"
          - name: DD_HOSTNAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName          
        resources:
          {}
        volumeMounts:
          - name: installinfo
            subPath: install_info
            mountPath: /etc/datadog-agent/install_info
            readOnly: true
          - name: config
            mountPath: /etc/datadog-agent
        livenessProbe:
          failureThreshold: 6
          httpGet:
            path: /live
            port: 5557
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        readinessProbe:
          failureThreshold: 6
          httpGet:
            path: /ready
            port: 5557
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
      volumes:
        - name: installinfo
          configMap:
            name: datadog-agent-installinfo
        - name: config
          emptyDir: {}
      affinity:
        # Prefer scheduling the runners on different nodes if possible
        # for better checks stability in case of node failure.
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 50
            podAffinityTerm:
              labelSelector:
                matchLabels:
                  app: datadog-agent-clusterchecks
              topologyKey: kubernetes.io/hostname
      nodeSelector:
        kubernetes.io/os: linux
---

# Source: datadog/templates/cluster-agent-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: datadog-agent-cluster-agent
  namespace: default
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
    app.kubernetes.io/component: cluster-agent
    
spec:
  replicas: 1
  revisionHistoryLimit: 10
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
    type: RollingUpdate
  selector:
    matchLabels:
      app: datadog-agent-cluster-agent
  template:
    metadata:
      labels:
        app.kubernetes.io/name: "datadog-agent"
        app.kubernetes.io/instance: "datadog-agent"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: cluster-agent
        app: datadog-agent-cluster-agent
        
      name: datadog-agent-cluster-agent
      annotations:
        checksum/clusteragent_token: e3fc9119562dc345d83ca7b38d71921c91812e6ca18fd35192807c8284fea99f
        checksum/install_info: 38d9679f595611e5080f5d6eb1937ad487e93f12aec25c949d63e991d46ca92b

    spec:
      serviceAccountName: datadog-agent-cluster-agent
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      containers:
      - name: cluster-agent
        image: "gcr.io/datadoghq/cluster-agent:7.41.1"
        imagePullPolicy: IfNotPresent
        resources:
          {}
        ports:
        - containerPort: 5005
          name: agentport
          protocol: TCP
        - containerPort: 5000
          name: agentmetrics
          protocol: TCP
        - containerPort: 8443
          name: metricsapi
          protocol: TCP
        envFrom:
          - secretRef:
              name: cluster-secrets
        env:
          - name: DD_HEALTH_PORT
            value: "5556"
          - name: DD_API_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: api-key
                optional: true
          - name: DD_TAGS
            value: "service:optiq"
          - name: DD_APP_KEY
            valueFrom:
              secretKeyRef:
                name: "datadog-secrets"
                key: app-key
          - name: DD_EXTERNAL_METRICS_PROVIDER_ENABLED
            value: "true"
          - name: DD_EXTERNAL_METRICS_PROVIDER_PORT
            value: "8443"
          - name: DD_EXTERNAL_METRICS_PROVIDER_WPA_CONTROLLER
            value: "false"
          - name: DD_EXTERNAL_METRICS_PROVIDER_USE_DATADOGMETRIC_CRD
            value: "true"
          - name: DD_EXTERNAL_METRICS_AGGREGATOR
            value: "avg"
          - name: DD_ADMISSION_CONTROLLER_ENABLED
            value: "true"
          - name: DD_ADMISSION_CONTROLLER_MUTATE_UNLABELLED
            value: "false"
          - name: DD_ADMISSION_CONTROLLER_SERVICE_NAME
            value: datadog-agent-cluster-agent-admission-controller
          - name: DD_ADMISSION_CONTROLLER_FAILURE_POLICY
            value: "Ignore"
          - name: DD_CLUSTER_CHECKS_ENABLED
            value: "true"
          - name: DD_EXTRA_CONFIG_PROVIDERS
            value: "kube_endpoints kube_services"
          - name: DD_EXTRA_LISTENERS
            value: "kube_endpoints kube_services"
          - name: DD_LOG_LEVEL
            value: "INFO"
          - name: DD_LEADER_ELECTION
            value: "true"
          - name: DD_LEADER_LEASE_DURATION
            value: "15"
          - name: DD_LEADER_LEASE_NAME
            value: datadog-agent-leader-election
          - name: DD_CLUSTER_AGENT_TOKEN_NAME
            value: datadog-agenttoken
          - name: DD_COLLECT_KUBERNETES_EVENTS
            value: "true"
          - name: DD_CLUSTER_AGENT_KUBERNETES_SERVICE_NAME
            value: datadog-agent-cluster-agent
          - name: DD_CLUSTER_AGENT_AUTH_TOKEN
            valueFrom:
              secretKeyRef:
                name: datadog-agent-cluster-agent
                key: token
          - name: DD_KUBE_RESOURCES_NAMESPACE
            value: default
          - name: DD_ORCHESTRATOR_EXPLORER_ENABLED
            value: "true"
          - name: DD_ORCHESTRATOR_EXPLORER_CONTAINER_SCRUBBING_ENABLED
            value: "true"
          - name: DD_COMPLIANCE_CONFIG_ENABLED
            value:  "true"
          - name: DD_COMPLIANCE_CONFIG_CHECK_INTERVAL
            value: "20m"          
        livenessProbe:
          failureThreshold: 6
          httpGet:
            path: /live
            port: 5556
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        readinessProbe:
          failureThreshold: 6
          httpGet:
            path: /ready
            port: 5556
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 15
          successThreshold: 1
          timeoutSeconds: 5
        volumeMounts:
          - name: installinfo
            subPath: install_info
            mountPath: /etc/datadog-agent/install_info
            readOnly: true
          - name: confd
            mountPath: /conf.d
            readOnly: true
      volumes:
        - name: installinfo
          configMap:
            name: datadog-agent-installinfo
        - name: confd
          configMap:
            name: datadog-agent-cluster-agent-confd
            items:
            - key: kubernetes_state_core.yaml.default
              path: kubernetes_state_core.yaml.default
      affinity:
        # Prefer scheduling the cluster agents on different nodes
        # to guarantee that the standby instance can immediately take the lead from a leader running of a faulty node.
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 50
            podAffinityTerm:
              labelSelector:
                matchLabels:
                  app: datadog-agent-cluster-agent
              topologyKey: kubernetes.io/hostname
      nodeSelector:
        kubernetes.io/os: linux
---

# Source: datadog/templates/agent-apiservice.yaml
apiVersion: apiregistration.k8s.io/v1
kind: APIService
metadata:
  name: v1beta1.external.metrics.k8s.io
  labels:
    helm.sh/chart: 'datadog-3.6.7'
    app.kubernetes.io/name: "datadog-agent"
    app.kubernetes.io/instance: "datadog-agent"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "7"
spec:
  service:
    name: datadog-agent-cluster-agent-metrics-api
    namespace: default
    port: 8443
  version: v1beta1
  insecureSkipTLSVerify: true
  group: external.metrics.k8s.io
  groupPriorityMinimum: 100
  versionPriority: 100

